<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Science-Based Workout Tracker</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#ffffff">
    <!-- Add icons/meta for PWA installability -->
    <link rel="icon" href="icon-192x192.png" sizes="192x192">
    <link rel="apple-touch-icon" href="icon-192x192.png">
    <style>
        body { font-family: Arial, sans-serif; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        button { margin: 5px; }
    </style>
</head>
<body>
    <h1>Science-Based Workout Tracker</h1>
    <select id="workout-select"></select>
    <button id="save-btn">Save Progress</button>
    <button id="load-btn">Load Progress</button>
    <button id="reset-btn">Reset</button>
    <button id="export-btn">Export as Text</button>
    <div id="workout-container"></div>

    <script>
        const workouts = {
            "Back - Workout 1": [
                {exercise: "Scap Pull-Down Primer", reps: "1-2 x 10-15 (submaximal)"},
                // Add all original and Spartan workouts here, similar to Python data
                // Example for Spartan:
                "Spartan Chest/Back/Triceps A": [
                    {exercise: "Bench Press", reps: "5 sets pyramid (15-20, 12-15, 8-12, 6-8, 5 reps)"},
                    {exercise: "Deadlift", reps: "5 sets pyramid (15-20, 12-15, 8-12, 6-8, 5 reps)"},
                    {exercise: "Chin-ups", reps: "3 sets to failure"},
                    {exercise: "Close Grip Bench", reps: "5 sets pyramid"},
                    {exercise: "Diamond Pushups", reps: "3 sets to failure"}
                ],
                // ... Add the rest of your workouts ...
            };

        let currentWorkout = null;
        let setData = {};

        function populateDropdown() {
            const select = document.getElementById('workout-select');
            for (let key in workouts) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = key;
                select.appendChild(option);
            }
            select.addEventListener('change', displayWorkout);
        }

        function displayWorkout() {
            currentWorkout = document.getElementById('workout-select').value;
            const container = document.getElementById('workout-container');
            container.innerHTML = '';
            workouts[currentWorkout].forEach(ex => {
                const div = document.createElement('div');
                div.innerHTML = `<h3>${ex.exercise} - ${ex.reps}</h3>`;
                const setsDiv = document.createElement('div');
                if (!setData[ex.exercise]) setData[ex.exercise] = [];
                setData[ex.exercise].forEach((s, idx) => addSetInput(setsDiv, ex.exercise, idx, s.reps, s.weight));
                const addBtn = document.createElement('button');
                addBtn.textContent = 'Add Set';
                addBtn.onclick = () => addSet(ex.exercise);
                div.appendChild(setsDiv);
                div.appendChild(addBtn);
                container.appendChild(div);
            });
        }

        function addSet(exercise) {
            if (!setData[exercise]) setData[exercise] = [];
            setData[exercise].push({reps: '', weight: ''});
            displayWorkout();
        }

        function addSetInput(parent, exercise, idx, reps = '', weight = '') {
            const setDiv = document.createElement('div');
            setDiv.innerHTML = `Set ${idx + 1}: Reps <input value="${reps}"> Weight <input value="${weight}">`;
            parent.appendChild(setDiv);
        }

        document.getElementById('save-btn').onclick = () => localStorage.setItem('workoutData', JSON.stringify(setData));
        document.getElementById('load-btn').onclick = () => {
            const data = localStorage.getItem('workoutData');
            if (data) setData = JSON.parse(data);
            displayWorkout();
        };
        document.getElementById('reset-btn').onclick = () => { setData = {}; displayWorkout(); };
        document.getElementById('export-btn').onclick = () => {
            let text = `Science-Based Workout Tracker\n${currentWorkout}\n`;
            workouts[currentWorkout].forEach(ex => {
                text += `${ex.exercise} ${ex.reps}\n`;
                if (setData[ex.exercise]) setData[ex.exercise].forEach((s, idx) => text += `  Set ${idx + 1}: Reps ${s.reps}, Weight ${s.weight}\n`);
            });
            const blob = new Blob([text], {type: 'text/plain'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'workout_export.txt';
            a.click();
        };

        populateDropdown();

        // Register service worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(reg => console.log('Service Worker registered'))
                    .catch(err => console.log('Service Worker registration failed:', err));
            });
        }
    </script>
</body>
</html>
